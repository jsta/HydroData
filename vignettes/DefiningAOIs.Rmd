---
title: "Defining a HydroData Area of Interest (AOI)"
output: html_document
---

```{r, include = F}
devtools::load_all(".")
library(sf)
```

**HydroData** is an R package that lets users find, download and explore earth system data for an area of interest (AOI). The core input the user needs is their AOI. **HydroData** offers three paramaters to define an AOI. These include  *state*, *county*, and *clip_unit*. The following document provides examples on how to use these parameters to define an AOI for data extraction:

## *Method 1*: Defining an AOI by *state*   

#### A *state* name or abbrivaiation can be used to define an AOI.

```{r}
CA = getAOI(state = 'CA')
```

```{r, echo = FALSE}
leaflet() %>% addProviderTiles(providers$CartoDB.Positron) %>% addPolygons(data = CA,fillColor = "transparent", color = 'red', weight = 1)
```

#### Multiple *states* can also be queried:

```{r}
WestCoast = getAOI(state = c("Oregon", "Washington", "CA"))
```

```{r, echo = FALSE}
leaflet() %>% addProviderTiles(providers$CartoDB.Positron) %>% addPolygons(data = WestCoast,fillColor = "transparent", color = "red", weight = 1)
```

##*Method 2*: Defining an AOI by *County*  

#### Defining an AOI by *county* requires a *state* as well

```{r}
EP = getAOI(state = "CO", county = "El Paso")
```

```{r, echo = FALSE}
leaflet() %>% addProviderTiles(providers$CartoDB.Positron) %>% addPolygons(data = EP,fillColor = "red", color = "red", weight = 4)
```

#### Multiple *counties* can also be queried:

```{r}
centralCoast = getAOI(state ="CA", county = c("Santa Barbara", "San Luis Obispo", "Ventura"))
```

```{r, echo = FALSE}
leaflet() %>% addProviderTiles(providers$CartoDB.Positron) %>% addPolygons(data = centralCoast,fillColor = "transparent", color = "red", weight = 1)
```



##*Method 3*: The clip_unit

In HydroData a clip_unit is a region that can be used to subset data. Most commonly, this is a bounding box or a user supplied shapefile - both of which can be input as a clip_unit. To build a bounding box in HydroData clip unit has five potential inputs:

(1) Location   
(2) Bounding box height (miles)   
(3) Bounding box width (miles)  
(4) location origin (optional)   

Inputs must be provided as a list, and order DOES matter. Examples for each input follow: 

### The *clip_unit* list()

#### 1. Location

A Location is the first  input for a clip_unit list. It can be given as a colloquial name or as a lat, long pair. Names are geocoded via the Google API and the dismo package.   

#### Grand Canyon (Location example):

Here we look at the Grand Canyon, using both the name and the lat,long found with a Google search.Notice the slightly different locations are generated:

```{r}
GC_name = getAOI(clip_unit = list("grand canyon", 10, 10))

GC_lat_lon = getAOI(clip_unit = list(36.0544, -112.1401, 10, 10))
```

```{r, echo = FALSE}

latlon = "<strong>Query by Lat Long</strong>"
API = "<strong>Query by Name</strong>"
gc = dismo::geocode("grand canyon")

icon.r <- makeAwesomeIcon(icon = 'home', markerColor = 'red')
icon.b <- makeAwesomeIcon(icon = 'home', markerColor = 'blue')


leaflet() %>% addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(data = GC_name,fillColor = "transparent", color = "blue", weight = 4) %>% 
  addPolygons(data = GC_lat_lon,fillColor = "transparent", color = "red", weight = 4) %>% 
  addAwesomeMarkers(icon = icon.b, lat = gc$latitude[1], lng = gc$longitude[1], popup = API) %>% 
  addAwesomeMarkers(icon = icon.r, lat = 36.0544 , lng = -112.1401, popup = latlon)
```


#### 2. Bounding box height and width

The next two values in a *clip_unit* list are a bounding box height and width in miles. The first entry defines  height and the second  width: 

#### National Water Center (bounding box diminsions example):

```{r}
nwc.tall = getAOI(clip_unit = list("National Water Center, AL", 30, 10))
nwc.wide = getAOI(clip_unit = list("National Water Center, AL", 10, 30))
nwc = dismo::geocode("National Water Center, AL")
```

```{r, echo = FALSE}
leaflet() %>% addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(data = nwc.tall,fillColor = "transparent", color = "blue", weight = 4, label = "Tall: list('National Water Center, AL', 30, 10)") %>%  
  addPolygons(data = nwc.wide, fillColor = "transparent", color = "red", weight = 4, label = "Wide: list('National Water Center, AL', 30, 10)") %>% 
  addAwesomeMarkers(icon = icon.r, lat = nwc$latitude[1], lng = nwc$longitude[1], popup = "National Water Center")
```

####3. Origin

In previous examples, bounding boxes are generated using the location as a centroid. You can change this by adding a final argument to the clip_unit list specifying where the location lies in reference to the bounding box. Options include 'center', 'lowerleft', 'lowerright', 'upperleft', 'upperright':

#### UCSB (origin example):

```{r}
ucsb.c =  getAOI(clip_unit =  list("UCSB", 10, 10, "center"))
ucsb.ul = getAOI(clip_unit = list("UCSB", 10, 10, "upperleft"))
ucsb.ur = getAOI(clip_unit = list("UCSB", 10, 10, "upperright"))
ucsb.ll = getAOI(clip_unit = list("UCSB", 10, 10, "lowerleft"))
ucsb.lr = getAOI(clip_unit = list("UCSB", 10, 10, "lowerright"))
```

```{r, echo = FALSE}
leaflet() %>% addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(data = ucsb.ul, fillColor = "transparent", color = "black", weight = 4, label = "upperleft") %>% 
  addPolygons(data = ucsb.ur, fillColor = "transparent", color = "black", weight = 4, label = "upperright") %>% 
  addPolygons(data = ucsb.ll, fillColor = "transparent", color = "black", weight = 4, label = "lowerleft") %>% 
  addPolygons(data = ucsb.lr, fillColor = "transparent", color = "black", weight = 4, label = "lowerright") %>% 
  addPolygons(data = ucsb.c,  fillColor = "transparent", color = "red", weight = 4, label = "center") %>% 
  addAwesomeMarkers(icon = icon.r, lat = 34.41396, lng = -119.8489, popup = 'UCSB')
```

### Clip_unit by User Shapefile

While overkill here... It is worth noting that a shapefile can be used as input for the clip_unit parameter

#### Santa Monica (user shapefile example):

```{r}
LA = rgdal::readOGR("/Users/mikejohnson/Documents/GitHub/Communities1/Communities.shp")
SM = LA[LA$LABEL_CITY == 'Santa Monica',] %>% spTransform(HydroDataProj)

AOI = getAOI(clip_unit = SM)
```

```{r, echo = FALSE}
leaflet() %>% addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(data = AOI,fillColor = "red", color = "red", weight = 4, label = "Santa Monica")
```

## Practical Examples: 

Up until this point, example have been shown using getAOI(). This function is built into every HydroData function allowing users to define their AOI in a consistent fashion for every data type they want. Three examples following showing how AOI's are defined within the context of function and more example can be found at the [vignette here.](https://rawgit.com/mikejohnson51/HydroData/master/vignettes/HydroData_example.html)

#### Find all Army Corps Dams from the Natonal Inventory of Dams within Texas using state:

```{r}

dams = findNID(state = 'Texas')

explore(dams)

```

### Find all water bodies intersecting a 100 square mile area to the northwest of Cheyenne Wyoming using a clip_unit list():  

```{r}

lakes = findWaterbodies(clip_unit = list("Cheyenne, Wyoming", 100, 100, origin = "lowerright"))

explore(lakes) %>% addPolygons(data = getAOI(clip_unit = list("Cheyenne, Wyoming", 100, 100, origin = "lowerright")), fillColor = 'transparent', color = 'black')

```

#### Find all GHCN station recording precipitation in Santa Monica using a shapefile:


```{r}
prcp = findGHCN(clip_unit = SM, parameters = 'PRCP')

explore(prcp) %>% addPolygons(data = SM, fillColor = "transparent", color = 'black')

```

